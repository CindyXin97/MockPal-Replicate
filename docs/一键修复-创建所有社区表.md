# ğŸš€ ä¸€é”®ä¿®å¤ï¼šåˆ›å»ºæ‰€æœ‰ç¤¾åŒºåŠŸèƒ½è¡¨

## ğŸ“‹ é—®é¢˜è¯´æ˜

ä½ é‡åˆ°çš„é—®é¢˜æ˜¯ï¼š**ç‚¹èµåæ•°å­—ä¸æ›´æ–° + é¡µé¢æŠ¥500é”™è¯¯**

**æ ¹æœ¬åŸå› **ï¼š
- `interview_votes` è¡¨ä¸å­˜åœ¨ â†’ ç‚¹èµæ•°æ®æ— æ³•ä¿å­˜
- `interview_comments` è¡¨ä¸å­˜åœ¨ â†’ è¯„è®ºAPIæŠ¥500é”™è¯¯ â†’ é˜»å¡é¡µé¢åˆ·æ–° â†’ çœ‹èµ·æ¥ç‚¹èµæ²¡ç”Ÿæ•ˆ

## âœ… è§£å†³æ–¹æ¡ˆï¼šåœ¨æ•°æ®åº“ä¸­æ‰§è¡Œä»¥ä¸‹SQL

### æ­¥éª¤1ï¼šç™»å½•æ•°æ®åº“

è®¿é—® **https://console.neon.tech**
- é€‰æ‹©ä½ çš„é¡¹ç›®
- è¿›å…¥ **SQL Editor**

### æ­¥éª¤2ï¼šå¤åˆ¶å¹¶æ‰§è¡Œä»¥ä¸‹SQL

**ä¸€é”®åˆ›å»ºæ‰€æœ‰ç¤¾åŒºåŠŸèƒ½è¡¨**ï¼š

```sql
-- ============================================
-- ç¤¾åŒºåŠŸèƒ½è¡¨åˆ›å»ºè„šæœ¬
-- ============================================

-- 1. ç”¨æˆ·å‘å¸ƒçš„é¢è¯•é¢˜ç›®è¡¨
CREATE TABLE IF NOT EXISTS user_interview_posts (
  id SERIAL PRIMARY KEY,
  user_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  company VARCHAR(100) NOT NULL,
  position VARCHAR(100) NOT NULL,
  question_type VARCHAR(50) NOT NULL,
  difficulty VARCHAR(20) NOT NULL,
  interview_date DATE NOT NULL,
  question TEXT NOT NULL,
  recommended_answer TEXT,
  is_anonymous BOOLEAN DEFAULT FALSE,
  status VARCHAR(20) DEFAULT 'active',
  views_count INTEGER DEFAULT 0,
  created_at TIMESTAMP DEFAULT NOW() NOT NULL,
  updated_at TIMESTAMP DEFAULT NOW() NOT NULL
);

-- 2. è¯„è®ºè¡¨ï¼ˆæ”¯æŒç³»ç»Ÿé¢˜ç›®å’Œç”¨æˆ·å‘å¸ƒçš„é¢˜ç›®ï¼‰
CREATE TABLE IF NOT EXISTS interview_comments (
  id SERIAL PRIMARY KEY,
  user_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  post_type VARCHAR(20) NOT NULL, -- 'system' or 'user'
  post_id INTEGER NOT NULL,
  content TEXT NOT NULL,
  parent_comment_id INTEGER REFERENCES interview_comments(id) ON DELETE CASCADE,
  is_anonymous BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP DEFAULT NOW() NOT NULL,
  updated_at TIMESTAMP DEFAULT NOW() NOT NULL
);

-- 3. ç‚¹èµ/è¸©è¡¨ï¼ˆè¿™æ˜¯æœ€é‡è¦çš„ï¼ï¼‰
CREATE TABLE IF NOT EXISTS interview_votes (
  id SERIAL PRIMARY KEY,
  user_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  post_type VARCHAR(20) NOT NULL, -- 'system' or 'user'
  post_id INTEGER NOT NULL,       -- é¢˜ç›®IDï¼ˆç³»ç»Ÿé¢˜æˆ–ç”¨æˆ·é¢˜ï¼‰
  vote_type VARCHAR(10) NOT NULL, -- 'up' or 'down'
  created_at TIMESTAMP DEFAULT NOW() NOT NULL,
  updated_at TIMESTAMP DEFAULT NOW() NOT NULL,
  UNIQUE(user_id, post_type, post_id) -- æ¯ä¸ªç”¨æˆ·å¯¹æ¯ä¸ªé¢˜ç›®åªèƒ½æŠ•ä¸€æ¬¡ç¥¨
);

-- 4. åˆ›å»ºç´¢å¼•ï¼ˆæå‡æŸ¥è¯¢æ€§èƒ½ï¼‰
CREATE INDEX IF NOT EXISTS idx_user_posts_user_id ON user_interview_posts(user_id);
CREATE INDEX IF NOT EXISTS idx_user_posts_company ON user_interview_posts(company);
CREATE INDEX IF NOT EXISTS idx_user_posts_position ON user_interview_posts(position);
CREATE INDEX IF NOT EXISTS idx_user_posts_status ON user_interview_posts(status);
CREATE INDEX IF NOT EXISTS idx_user_posts_created_at ON user_interview_posts(created_at DESC);

CREATE INDEX IF NOT EXISTS idx_comments_post ON interview_comments(post_type, post_id);
CREATE INDEX IF NOT EXISTS idx_comments_user ON interview_comments(user_id);
CREATE INDEX IF NOT EXISTS idx_comments_parent ON interview_comments(parent_comment_id);
CREATE INDEX IF NOT EXISTS idx_comments_created_at ON interview_comments(created_at DESC);

CREATE INDEX IF NOT EXISTS idx_votes_post ON interview_votes(post_type, post_id);
CREATE INDEX IF NOT EXISTS idx_votes_user ON interview_votes(user_id);
CREATE INDEX IF NOT EXISTS idx_votes_vote_type ON interview_votes(vote_type);

-- 5. æ·»åŠ è¡¨æ³¨é‡Š
COMMENT ON TABLE user_interview_posts IS 'ç”¨æˆ·å‘å¸ƒçš„é¢è¯•é¢˜ç›®';
COMMENT ON TABLE interview_comments IS 'é¢è¯•é¢˜ç›®è¯„è®ºè¡¨ï¼ˆæ”¯æŒç³»ç»Ÿé¢˜å’Œç”¨æˆ·é¢˜ï¼‰';
COMMENT ON TABLE interview_votes IS 'é¢è¯•é¢˜ç›®ç‚¹èµ/è¸©è¡¨';

-- å®Œæˆï¼
SELECT 'SQLæ‰§è¡Œå®Œæˆï¼æ‰€æœ‰ç¤¾åŒºåŠŸèƒ½è¡¨å·²åˆ›å»ºã€‚' AS message;
```

### æ­¥éª¤3ï¼šéªŒè¯åˆ›å»ºæˆåŠŸ

æ‰§è¡Œä»¥ä¸‹SQLéªŒè¯ï¼š

```sql
-- æ£€æŸ¥è¡¨æ˜¯å¦éƒ½åˆ›å»ºæˆåŠŸ
SELECT 
  table_name,
  (SELECT COUNT(*) FROM information_schema.tables WHERE tablename = t.table_name) AS exists
FROM (
  VALUES 
    ('user_interview_posts'),
    ('interview_comments'),
    ('interview_votes')
) AS t(table_name);
```

åº”è¯¥çœ‹åˆ°æ‰€æœ‰è¡¨çš„ `exists` åˆ—éƒ½æ˜¯ `1`ã€‚

### æ­¥éª¤4ï¼šåˆ·æ–°ç½‘é¡µæµ‹è¯•

1. å›åˆ°æµè§ˆå™¨
2. **åˆ·æ–°é¡µé¢**ï¼ˆF5 æˆ– Cmd+Rï¼‰
3. ç‚¹å‡»ç‚¹èµ ğŸ‘
4. è§‚å¯Ÿï¼š
   - âœ… æ•°å­—ä» 0 å˜æˆ 1
   - âœ… æŒ‰é’®å˜æˆè“è‰²
   - âœ… æ˜¾ç¤º"ç‚¹èµæˆåŠŸ"
   - âœ… é¡µé¢ä¸å†æŠ¥ 500 é”™è¯¯

### æ­¥éª¤5ï¼šéªŒè¯æ•°æ®æ˜¯å¦ä¿å­˜

åœ¨æ•°æ®åº“ä¸­è¿è¡Œï¼š

```sql
-- æŸ¥çœ‹æœ€è¿‘çš„æŠ•ç¥¨è®°å½•
SELECT 
  v.id,
  u.name AS user_name,
  v.post_type,
  v.post_id,
  v.vote_type,
  v.created_at
FROM interview_votes v
JOIN users u ON v.user_id = u.id
ORDER BY v.created_at DESC
LIMIT 10;
```

åº”è¯¥èƒ½çœ‹åˆ°ä½ åˆšæ‰çš„ç‚¹èµè®°å½•ï¼

---

## ğŸ¯ ä»£ç ä¿®å¤è¯´æ˜

æˆ‘å·²ç»ä¿®å¤äº†ä»¥ä¸‹ä»£ç é—®é¢˜ï¼š

### 1. è¯„è®ºAPIä¿®å¤ âœ…

**æ–‡ä»¶**ï¼š`app/api/interview-comments/route.ts`

**ä¿®å¤å†…å®¹**ï¼š
- å½“ `interview_comments` è¡¨ä¸å­˜åœ¨æ—¶ï¼Œè¿”å›ç©ºæ•°æ®è€Œä¸æ˜¯ 500 é”™è¯¯
- æ·»åŠ äº†è¯¦ç»†çš„æ—¥å¿—
- ä¸å†é˜»å¡é¡µé¢åˆ·æ–°

### 2. æŠ•ç¥¨ç»„ä»¶æ—¥å¿— âœ…

**æ–‡ä»¶**ï¼š`components/vote-buttons.tsx`

**å·²æ·»åŠ **ï¼š
- è¯¦ç»†çš„å‰ç«¯æ—¥å¿—ï¼Œæ–¹ä¾¿è°ƒè¯•

### 3. æŠ•ç¥¨APIæ—¥å¿— âœ…

**æ–‡ä»¶**ï¼š`app/api/interview-votes/route.ts`

**å·²æ·»åŠ **ï¼š
- è¯¦ç»†çš„åç«¯æ—¥å¿—
- æ›´å¥½çš„é”™è¯¯æç¤º

---

## ğŸ“Š æ•´ä½“æ¶æ„

```
é¢è¯•é¢˜ç›®
   â”œâ”€â”€ ç³»ç»Ÿé¢˜ç›® (interview_questions) â† å·²å­˜åœ¨
   â”‚   â””â”€â”€ post_type = 'system'
   â”‚
   â””â”€â”€ ç”¨æˆ·å‘å¸ƒ (user_interview_posts) â† æ–°è¡¨
       â””â”€â”€ post_type = 'user'

è¯„è®ºç³»ç»Ÿ (interview_comments) â† æ–°è¡¨
   â”œâ”€â”€ æ”¯æŒç³»ç»Ÿé¢˜ç›®è¯„è®º
   â””â”€â”€ æ”¯æŒç”¨æˆ·é¢˜ç›®è¯„è®º

ç‚¹èµç³»ç»Ÿ (interview_votes) â† æ–°è¡¨ â­ é‡è¦ï¼
   â”œâ”€â”€ æ”¯æŒç³»ç»Ÿé¢˜ç›®ç‚¹èµ
   â””â”€â”€ æ”¯æŒç”¨æˆ·é¢˜ç›®ç‚¹èµ
```

---

## â“ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆä¹‹å‰ç‚¹èµæ˜¾ç¤º"æˆåŠŸ"ä½†æ•°æ®åº“æ²¡è®°å½•ï¼Ÿ

**A**: å› ä¸º API ä»£ç å†™å¾—ä¸ä¸¥è°¨ï¼Œæ²¡æœ‰æ£€æŸ¥è¡¨æ˜¯å¦å­˜åœ¨å°±è¿”å›äº†"æˆåŠŸ"ã€‚ç°åœ¨å·²ç»ä¿®å¤ã€‚

### Q2: è¯„è®ºè¡¨åˆ›å»ºäº†ï¼Œä½†æˆ‘ä¸æƒ³è¦è¯„è®ºåŠŸèƒ½æ€ä¹ˆåŠï¼Ÿ

**A**: æ²¡å…³ç³»ï¼Œè¡¨åˆ›å»ºåå³ä½¿ä¸ä½¿ç”¨è¯„è®ºåŠŸèƒ½ä¹Ÿä¸å½±å“ã€‚å®ƒåªæ˜¯è¿”å›ç©ºæ•°æ®ã€‚

### Q3: å¦‚æœæˆ‘åªæƒ³è¦ç‚¹èµåŠŸèƒ½ï¼Œåªåˆ›å»º interview_votes è¡¨å¯ä»¥å—ï¼Ÿ

**A**: å¯ä»¥ï¼Œä½†å»ºè®®ä¸€æ¬¡æ€§åˆ›å»ºæ‰€æœ‰è¡¨ï¼Œé¿å…ä»¥åå†å‡ºç°ç±»ä¼¼é—®é¢˜ã€‚

---

## âœ… æ‰§è¡Œåçš„æ•ˆæœ

æ‰§è¡ŒSQLåï¼Œä½ å°†æ‹¥æœ‰ï¼š

1. âœ… **ç‚¹èµåŠŸèƒ½** - å®Œå…¨å¯ç”¨
2. âœ… **è¯„è®ºåŠŸèƒ½** - å®Œå…¨å¯ç”¨
3. âœ… **ç”¨æˆ·å‘å¸–åŠŸèƒ½** - å®Œå…¨å¯ç”¨
4. âœ… **é¡µé¢ä¸å†æŠ¥é”™** - 500é”™è¯¯æ¶ˆå¤±
5. âœ… **æ•°æ®æŒä¹…åŒ–** - æ‰€æœ‰æ“ä½œéƒ½ä¿å­˜åˆ°æ•°æ®åº“

---

## ğŸš€ ä¸‹ä¸€æ­¥

æ‰§è¡ŒSQLåï¼Œå‘Šè¯‰æˆ‘ï¼š
1. SQLæ‰§è¡ŒæˆåŠŸäº†å—ï¼Ÿ
2. ç‚¹èµåŠŸèƒ½ç°åœ¨èƒ½æ­£å¸¸å·¥ä½œäº†å—ï¼Ÿï¼ˆæ•°å­—ä¼šå˜åŒ–å—ï¼Ÿï¼‰
3. é¡µé¢è¿˜æœ‰500é”™è¯¯å—ï¼Ÿ

