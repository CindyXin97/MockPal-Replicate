# 如何启用社区功能 🚀

## 📌 当前状态

✅ **题库已恢复正常显示**
⏸️ **社区功能暂时禁用**（发帖、评论、点赞功能）

## 🔍 为什么题库看不见了？

**简单解释**：
- 我添加了新功能，需要创建3个新的数据库表
- 新代码会查询这些表，但表还不存在
- 所以整个查询失败，题库就看不到了

**技术解释**：
- 修改后的 API 包含了对 `user_interview_posts` 表的查询
- 如果数据库迁移未运行，该表不存在
- 查询失败导致整个 API 返回错误

## ✅ 现在的解决方案

我已经**临时禁用**了社区功能，题库恢复正常显示：

1. ✅ 原有的系统题库正常显示
2. ✅ 筛选、分页功能正常
3. ⏸️ 发帖按钮暂时隐藏
4. ⏸️ 点赞/踩功能暂时隐藏
5. ⏸️ 评论功能暂时隐藏

## 🚀 如何完全启用社区功能？

### 第1步：运行数据库迁移

你需要在**生产环境**或**有数据库访问权限的环境**中运行：

**选项A：使用脚本**
```bash
npx tsx scripts/run-community-migration.ts
```

**选项B：手动在数据库控制台执行SQL**

登录你的 Vercel Neon 数据库控制台，执行这个文件的内容：
```
lib/db/migrations/0012_add_community_features.sql
```

### 第2步：启用前端功能

运行迁移成功后，在 `app/matches/page.tsx` 中：

1. **启用用户帖子查询**（第96行）：
```typescript
// 改为：
includeUserPosts: 'true',
```

2. **取消注释发帖按钮**（第168-173行）：
```typescript
// 删除注释符号，恢复：
<Button
  onClick={() => setShowPostModal(true)}
  className="bg-blue-600 hover:bg-blue-700 text-white font-medium px-6 py-2"
>
  📝 发布题目
</Button>
```

3. **取消注释发帖弹窗**（第177-185行）：
```typescript
// 删除注释符号，恢复：
<PostQuestionModal
  isOpen={showPostModal}
  onClose={() => setShowPostModal(false)}
  onSuccess={fetchQuestions}
  filterOptions={{
    companies: filterOptions.companies,
    positions: filterOptions.positions,
  }}
/>
```

### 第3步：验证功能

1. 刷新页面，题库应该还是正常显示
2. 右上角应该出现"📝 发布题目"按钮
3. 展开题目应该能看到点赞/踩和评论功能

## 📋 数据库迁移会做什么？

**只会添加3个新表**，不会影响现有数据：

1. `user_interview_posts` - 存储用户发布的题目
2. `interview_comments` - 存储评论
3. `interview_votes` - 存储点赞/踩

**绝对不会**：
- ❌ 删除现有题库
- ❌ 修改现有表结构
- ❌ 影响用户数据

## 🔒 安全性保证

迁移脚本使用 `CREATE TABLE IF NOT EXISTS`，意味着：
- ✅ 如果表已存在，不会重复创建
- ✅ 不会覆盖任何现有数据
- ✅ 可以安全地多次运行

## 💡 提示

如果你不想启用社区功能，**什么都不用做**！
- 题库已经恢复正常
- 所有原有功能都正常工作
- 只是没有发帖、评论、点赞功能而已

## 📞 需要帮助？

如果在启用过程中遇到问题：
1. 检查数据库连接是否正常
2. 确认迁移脚本是否成功执行
3. 查看浏览器控制台是否有错误

---

**总结**：题库已恢复，社区功能等你准备好了再启用！🎉

