# é¢è¯•çœŸé¢˜ç¤¾åŒºåŒ–åŠŸèƒ½åˆ†ææ–‡æ¡£

## ğŸ“‹ éœ€æ±‚æ€»ç»“

### 1. ç”¨æˆ·å‘å¸–åŠŸèƒ½
- **åŠŸèƒ½æè¿°**: åœ¨é¢è¯•çœŸé¢˜é¡µé¢é¡¶éƒ¨æ·»åŠ "å‘å¸ƒé¢˜ç›®"æŒ‰é’®
- **äº¤äº’æµç¨‹**:
  - ç‚¹å‡»æŒ‰é’® â†’ å¼¹å‡ºè¡¨å•å¼¹çª—
  - è¡¨å•åŒ…å«å­—æ®µ:
    - å…¬å¸é€‰æ‹©ï¼ˆä¸‹æ‹‰èœå•ï¼‰
    - å²—ä½é€‰æ‹©ï¼ˆä¸‹æ‹‰èœå•ï¼‰
    - é¢˜ç›®ç±»å‹ï¼ˆæŠ€æœ¯/è¡Œä¸º/æ¡ˆä¾‹/ç»Ÿè®¡ï¼‰
    - éš¾åº¦ï¼ˆç®€å•/ä¸­ç­‰/å›°éš¾ï¼‰
    - é¢è¯•æ—¶é—´ï¼ˆæ—¥æœŸé€‰æ‹©å™¨ï¼‰
    - é¢˜ç›®å†…å®¹ï¼ˆæ–‡æœ¬åŸŸï¼Œå¿…å¡«ï¼‰
    - æ¨èç­”æ¡ˆï¼ˆæ–‡æœ¬åŸŸï¼Œå¯é€‰ï¼‰
  - æäº¤åé¢˜ç›®æ˜¾ç¤ºåœ¨åˆ—è¡¨ä¸­
- **è®¾è®¡è¦æ±‚**: æŒ‰é’®ä¸ä½¿ç”¨æ¸å˜è‰²ï¼Œé‡‡ç”¨çº¯è‰²è®¾è®¡

### 2. å±•ç¤ºä¼˜å…ˆçº§
- **æ’åºè§„åˆ™**:
  1. ç”¨æˆ·è‡ªå·±å‘å¸ƒçš„é¢˜ç›®ï¼ˆç½®é¡¶ï¼‰
  2. ç³»ç»Ÿé¢„ç½®çš„å®˜æ–¹é¢˜ç›®
  3. å…¶ä»–ç”¨æˆ·å‘å¸ƒçš„é¢˜ç›®
- **è§†è§‰åŒºåˆ†**: ç”¨æˆ·è‡ªå·±çš„å¸–å­éœ€è¦æœ‰æ˜æ˜¾æ ‡è¯†

### 3. äº¤äº’ä¼˜åŒ–
- **æŠ˜å å±•ç¤º**: é»˜è®¤åªæ˜¾ç¤ºé¢˜ç›®æ‘˜è¦å’ŒåŸºæœ¬ä¿¡æ¯
- **ç‚¹å‡»å±•å¼€**: 
  - æ˜¾ç¤ºå®Œæ•´é¢˜ç›®å†…å®¹
  - æ˜¾ç¤ºæ¨èç­”æ¡ˆï¼ˆå¦‚æœ‰ï¼‰
  - æ˜¾ç¤ºè¯„è®ºåŒº
- **è¯„è®ºåŠŸèƒ½**:
  - ç”¨æˆ·å¯ä»¥åœ¨é¢˜ç›®ä¸‹è¯„è®ºè‡ªå·±çš„æƒ³æ³•
  - æ”¯æŒç³»ç»Ÿé¢˜ç›®å’Œç”¨æˆ·å‘å¸ƒçš„é¢˜ç›®

### 4. äº’åŠ¨åŠŸèƒ½
- **ç‚¹èµ/è¸©**:
  - æ¯ä¸ªé¢˜ç›®ä¸‹æ–¹æœ‰ğŸ‘å’ŒğŸ‘æŒ‰é’®
  - æ˜¾ç¤ºç‚¹èµ/è¸©çš„æ•°é‡
  - ç”¨æˆ·åªèƒ½æ“ä½œä¸€æ¬¡
  - å¯ä»¥åˆ‡æ¢æˆ–å–æ¶ˆ

## ğŸ¯ åˆç†æ€§åˆ†æ

### âœ… ä¼˜åŠ¿
1. **ç¤¾åŒºæ´»è·ƒåº¦**: ç”¨æˆ·ç”Ÿæˆå†…å®¹ï¼ˆUGCï¼‰å¢åŠ å¹³å°ç²˜æ€§
2. **å†…å®¹ä¸°å¯Œåº¦**: å¿«é€Ÿæ‰©å……é¢˜åº“ï¼Œè·å–æœ€æ–°é¢è¯•é¢˜
3. **çœŸå®æ€§**: ç”¨æˆ·äº²èº«ç»å†çš„é¢˜ç›®æ›´æœ‰å‚è€ƒä»·å€¼
4. **äº’åŠ¨æ€§**: è¯„è®ºå’Œç‚¹èµå¢å¼ºç”¨æˆ·å‚ä¸æ„Ÿ
5. **æ•°æ®ç§¯ç´¯**: ç”¨æˆ·è¡Œä¸ºæ•°æ®å¯ç”¨äºåç»­æ¨èç®—æ³•

### âš ï¸ éœ€è¦æ³¨æ„çš„é—®é¢˜
1. **å†…å®¹è´¨é‡**:
   - è§£å†³æ–¹æ¡ˆ: æ·»åŠ å®¡æ ¸æœºåˆ¶ï¼ˆå¯é€‰ï¼‰
   - ä½¿ç”¨ç‚¹èµ/è¸©æ¥æ ‡è¯†è´¨é‡
   
2. **é‡å¤å†…å®¹**:
   - è§£å†³æ–¹æ¡ˆ: åœ¨å‘å¸ƒå‰æ£€æŸ¥ç›¸ä¼¼é¢˜ç›®
   - åæœŸæ·»åŠ åˆå¹¶åŠŸèƒ½

3. **åƒåœ¾ä¿¡æ¯**:
   - è§£å†³æ–¹æ¡ˆ: 
     - é™åˆ¶å‘å¸ƒé¢‘ç‡ï¼ˆå¦‚æ¯å¤©æœ€å¤š5æ¡ï¼‰
     - ä¸¾æŠ¥æœºåˆ¶
     - ç®¡ç†å‘˜å®¡æ ¸åŠŸèƒ½

4. **åŒ¿åæ€§è€ƒè™‘**:
   - ç”¨æˆ·å¯èƒ½ä¸æƒ³å…¬å¼€èº«ä»½
   - è§£å†³æ–¹æ¡ˆ: è€ƒè™‘åŒ¿åå‘å¸ƒé€‰é¡¹

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### 1. ç”¨æˆ·å‘å¸ƒçš„é¢è¯•é¢˜ç›®è¡¨ (user_interview_posts)
```sql
CREATE TABLE user_interview_posts (
  id SERIAL PRIMARY KEY,
  user_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  company VARCHAR(100) NOT NULL,
  position VARCHAR(100) NOT NULL,
  question_type VARCHAR(50) NOT NULL, -- technical, behavioral, case_study, stats
  difficulty VARCHAR(20) NOT NULL, -- easy, medium, hard
  interview_date DATE NOT NULL, -- é¢è¯•æ—¥æœŸ
  question TEXT NOT NULL,
  recommended_answer TEXT, -- å¯é€‰çš„æ¨èç­”æ¡ˆ
  is_anonymous BOOLEAN DEFAULT FALSE, -- æ˜¯å¦åŒ¿åå‘å¸ƒ
  status VARCHAR(20) DEFAULT 'active', -- active, hidden, deleted
  views_count INTEGER DEFAULT 0, -- æµè§ˆæ¬¡æ•°
  created_at TIMESTAMP DEFAULT NOW() NOT NULL,
  updated_at TIMESTAMP DEFAULT NOW() NOT NULL
);

-- ç´¢å¼•ä¼˜åŒ–
CREATE INDEX idx_user_posts_user_id ON user_interview_posts(user_id);
CREATE INDEX idx_user_posts_company ON user_interview_posts(company);
CREATE INDEX idx_user_posts_position ON user_interview_posts(position);
CREATE INDEX idx_user_posts_status ON user_interview_posts(status);
CREATE INDEX idx_user_posts_created_at ON user_interview_posts(created_at DESC);
```

### 2. è¯„è®ºè¡¨ (interview_comments)
```sql
CREATE TABLE interview_comments (
  id SERIAL PRIMARY KEY,
  user_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  post_type VARCHAR(20) NOT NULL, -- 'system' or 'user'
  post_id INTEGER NOT NULL, -- interview_questions.id æˆ– user_interview_posts.id
  content TEXT NOT NULL,
  parent_comment_id INTEGER REFERENCES interview_comments(id), -- ç”¨äºå›å¤è¯„è®º
  is_anonymous BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP DEFAULT NOW() NOT NULL,
  updated_at TIMESTAMP DEFAULT NOW() NOT NULL
);

-- ç´¢å¼•ä¼˜åŒ–
CREATE INDEX idx_comments_post ON interview_comments(post_type, post_id);
CREATE INDEX idx_comments_user ON interview_comments(user_id);
CREATE INDEX idx_comments_parent ON interview_comments(parent_comment_id);
CREATE INDEX idx_comments_created_at ON interview_comments(created_at DESC);
```

### 3. ç‚¹èµ/è¸©è¡¨ (interview_votes)
```sql
CREATE TABLE interview_votes (
  id SERIAL PRIMARY KEY,
  user_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  post_type VARCHAR(20) NOT NULL, -- 'system' or 'user'
  post_id INTEGER NOT NULL,
  vote_type VARCHAR(10) NOT NULL, -- 'up' or 'down'
  created_at TIMESTAMP DEFAULT NOW() NOT NULL,
  updated_at TIMESTAMP DEFAULT NOW() NOT NULL,
  
  -- ç¡®ä¿æ¯ä¸ªç”¨æˆ·å¯¹æ¯ä¸ªå¸–å­åªèƒ½æŠ•ä¸€æ¬¡ç¥¨
  UNIQUE(user_id, post_type, post_id)
);

-- ç´¢å¼•ä¼˜åŒ–
CREATE INDEX idx_votes_post ON interview_votes(post_type, post_id);
CREATE INDEX idx_votes_user ON interview_votes(user_id);
```

### 4. ç»Ÿè®¡è§†å›¾ï¼ˆå¯é€‰ï¼Œç”¨äºæ€§èƒ½ä¼˜åŒ–ï¼‰
```sql
-- åˆ›å»ºç‰©åŒ–è§†å›¾æ¥ç¼“å­˜ç»Ÿè®¡æ•°æ®
CREATE MATERIALIZED VIEW interview_post_stats AS
SELECT 
  post_type,
  post_id,
  COUNT(CASE WHEN vote_type = 'up' THEN 1 END) as upvotes,
  COUNT(CASE WHEN vote_type = 'down' THEN 1 END) as downvotes,
  COUNT(CASE WHEN vote_type = 'up' THEN 1 END) - 
    COUNT(CASE WHEN vote_type = 'down' THEN 1 END) as score
FROM interview_votes
GROUP BY post_type, post_id;

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_post_stats_score ON interview_post_stats(score DESC);
```

## ğŸ”„ API è®¾è®¡

### 1. ç”¨æˆ·å‘å¸– API
```
POST /api/interview-posts
Body: {
  company: string
  position: string
  questionType: string
  difficulty: string
  interviewDate: string (YYYY-MM-DD)
  question: string
  recommendedAnswer?: string
  isAnonymous?: boolean
}
```

### 2. è·å–é¢˜ç›®åˆ—è¡¨ APIï¼ˆä¿®æ”¹ç°æœ‰ï¼‰
```
GET /api/interview-questions
Query params: 
  - ç°æœ‰å‚æ•°ä¿æŒä¸å˜
  - æ–°å¢: includeUserPosts=true
  - æ–°å¢: sortBy=latest|popular|score
Response: {
  questions: [
    {
      ...ç°æœ‰å­—æ®µ
      postType: 'system' | 'user'
      author?: { id, name }
      isOwnPost: boolean
      stats: { upvotes, downvotes, comments, views }
    }
  ]
}
```

### 3. è¯„è®º API
```
POST /api/interview-comments
Body: {
  postType: 'system' | 'user'
  postId: number
  content: string
  parentCommentId?: number
  isAnonymous?: boolean
}

GET /api/interview-comments?postType=user&postId=123
```

### 4. ç‚¹èµ/è¸© API
```
POST /api/interview-votes
Body: {
  postType: 'system' | 'user'
  postId: number
  voteType: 'up' | 'down'
}

DELETE /api/interview-votes?postType=user&postId=123
(å–æ¶ˆæŠ•ç¥¨)
```

## ğŸ¨ å‰ç«¯ç»„ä»¶è®¾è®¡

### 1. ç»„ä»¶ç»“æ„
```
InterviewQuestionsTab/
â”œâ”€â”€ PostQuestionButton (å‘å¸ƒæŒ‰é’®)
â”œâ”€â”€ PostQuestionModal (å‘å¸ƒå¼¹çª—)
â”œâ”€â”€ QuestionCard (é¢˜ç›®å¡ç‰‡)
â”‚   â”œâ”€â”€ QuestionHeader (æ ‡é¢˜æ  - å…¬å¸ã€å²—ä½ç­‰)
â”‚   â”œâ”€â”€ QuestionContent (å†…å®¹åŒº - å¯æŠ˜å )
â”‚   â”œâ”€â”€ QuestionActions (æ“ä½œæ  - ç‚¹èµ/è¸©)
â”‚   â””â”€â”€ CommentSection (è¯„è®ºåŒº)
â”‚       â”œâ”€â”€ CommentList
â”‚       â””â”€â”€ CommentForm
â””â”€â”€ FilterBar (ç­›é€‰æ  - æ–°å¢"æˆ‘çš„å‘å¸ƒ"é€‰é¡¹)
```

### 2. çŠ¶æ€ç®¡ç†
- ä½¿ç”¨ React useState ç®¡ç†å±€éƒ¨çŠ¶æ€
- å¦‚éœ€è¦ï¼Œå¯è€ƒè™‘ä½¿ç”¨ Jotai ç®¡ç†å…¨å±€çŠ¶æ€ï¼ˆå¦‚å½“å‰ç”¨æˆ·çš„æŠ•ç¥¨è®°å½•ï¼‰

## ğŸ“ å®æ–½æ­¥éª¤

### Phase 1: æ•°æ®åº“å’Œåç«¯ (ä¼˜å…ˆçº§: é«˜)
1. âœ… åˆ›å»ºæ•°æ®åº“è¿ç§»æ–‡ä»¶
2. âœ… æ›´æ–° schema.ts
3. âœ… åˆ›å»º/æ›´æ–° API è·¯ç”±
4. âœ… æµ‹è¯• API åŠŸèƒ½

### Phase 2: å‰ç«¯ç»„ä»¶ (ä¼˜å…ˆçº§: é«˜)
1. âœ… åˆ›å»ºå‘å¸–å¼¹çª—ç»„ä»¶
2. âœ… ä¿®æ”¹é¢˜ç›®å¡ç‰‡ç»„ä»¶ï¼ˆæŠ˜å /å±•å¼€ï¼‰
3. âœ… æ·»åŠ ç‚¹èµ/è¸©UI
4. âœ… åˆ›å»ºè¯„è®ºç»„ä»¶

### Phase 3: é›†æˆå’Œä¼˜åŒ– (ä¼˜å…ˆçº§: ä¸­)
1. âœ… é›†æˆæ‰€æœ‰ç»„ä»¶åˆ°ä¸»é¡µé¢
2. âœ… ä¼˜åŒ–æ’åºå’Œç­›é€‰é€»è¾‘
3. âœ… æ·»åŠ åŠ è½½çŠ¶æ€å’Œé”™è¯¯å¤„ç†
4. âœ… å“åº”å¼è®¾è®¡é€‚é…

### Phase 4: æ‰©å±•åŠŸèƒ½ (ä¼˜å…ˆçº§: ä½ï¼ŒåæœŸå®ç°)
1. â³ å†…å®¹å®¡æ ¸æœºåˆ¶
2. â³ ä¸¾æŠ¥åŠŸèƒ½
3. â³ é€šçŸ¥ç³»ç»Ÿï¼ˆæœ‰äººè¯„è®º/ç‚¹èµæ—¶é€šçŸ¥ï¼‰
4. â³ æœç´¢åŠŸèƒ½å¢å¼º
5. â³ æ•°æ®åˆ†ædashboard

## ğŸ”’ å®‰å…¨æ€§è€ƒè™‘

1. **èº«ä»½éªŒè¯**: æ‰€æœ‰å†™æ“ä½œéœ€è¦ç™»å½•
2. **æƒé™æ§åˆ¶**: ç”¨æˆ·åªèƒ½ç¼–è¾‘/åˆ é™¤è‡ªå·±çš„å¸–å­å’Œè¯„è®º
3. **å†…å®¹è¿‡æ»¤**: XSSé˜²æŠ¤ã€SQLæ³¨å…¥é˜²æŠ¤
4. **é¢‘ç‡é™åˆ¶**: é˜²æ­¢åˆ·å±å’Œæ»¥ç”¨
5. **æ•°æ®éªŒè¯**: å‰åç«¯åŒé‡éªŒè¯

## ğŸ“Š ç›‘æ§æŒ‡æ ‡

å»ºè®®è¿½è¸ªä»¥ä¸‹æŒ‡æ ‡ï¼š
- ç”¨æˆ·å‘å¸–æ•°é‡å’Œé¢‘ç‡
- è¯„è®ºæ´»è·ƒåº¦
- ç‚¹èµ/è¸©æ¯”ä¾‹
- é«˜åˆ†é¢˜ç›®æ’è¡Œ
- ç”¨æˆ·å‚ä¸ç‡

## âœ… ç»“è®º

è¿™ä¸ªç¤¾åŒºåŒ–åŠŸèƒ½è®¾è®¡åˆç†ä¸”å¯è¡Œï¼š
- âœ… æŠ€æœ¯å®ç°éš¾åº¦é€‚ä¸­
- âœ… æ•°æ®åº“è®¾è®¡è€ƒè™‘äº†æ‰©å±•æ€§å’Œæ€§èƒ½
- âœ… ç”¨æˆ·ä½“éªŒè®¾è®¡æ¸…æ™°
- âœ… å®‰å…¨æ€§å’Œæ•°æ®å®Œæ•´æ€§æœ‰ä¿éšœ
- âœ… ä¸ºåç»­åŠŸèƒ½æ‰©å±•ç•™æœ‰ç©ºé—´

å»ºè®®ç«‹å³å¼€å§‹å®æ–½ï¼Œå…ˆå®Œæˆæ ¸å¿ƒåŠŸèƒ½ï¼ˆå‘å¸–ã€å±•ç¤ºã€ç‚¹èµï¼‰ï¼Œåç»­å†è¿­ä»£æ·»åŠ è¯„è®ºå’Œå…¶ä»–é«˜çº§åŠŸèƒ½ã€‚

