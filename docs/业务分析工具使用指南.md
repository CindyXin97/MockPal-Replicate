# MockPal 业务分析工具使用指南

## 📁 工具文件清单

### 1. TypeScript 分析脚本
**文件**: `scripts/business-metrics-analysis.ts`

**功能**: 
- 自动分析所有核心业务指标
- 生成详细的数据报告
- 识别潜力用户和流失风险用户
- 提供具体的行动建议

**运行方式**:
```bash
# 方法1: 使用 tsx 直接运行（推荐）
npx tsx scripts/business-metrics-analysis.ts

# 方法2: 使用 ts-node
npx ts-node scripts/business-metrics-analysis.ts

# 方法3: 如果已经安装 tsx
tsx scripts/business-metrics-analysis.ts
```

**输出内容**:
- ✅ 用户指标（总数、增长、分布）
- ✅ 匹配指标（成功率、转化率）
- ✅ 活跃度指标（DAU、留存）
- ✅ 反馈与面试完成情况
- ✅ 转化漏斗分析
- ✅ 潜力用户识别
- ✅ 业务建议和行动清单

### 2. SQL 查询文件
**文件**: `scripts/business-metrics.sql`

**功能**:
- 包含所有核心指标的SQL查询
- 可以直接在数据库中执行
- 适合定期监控和导出数据

**使用方式**:

#### 方法A: 在 Neon Dashboard 中执行
1. 登录 [Neon Dashboard](https://console.neon.tech/)
2. 选择你的项目和数据库
3. 点击 "SQL Editor"
4. 复制 SQL 查询粘贴执行
5. 可以导出结果为 CSV

#### 方法B: 使用 psql 命令行
```bash
# 连接到数据库
psql $DATABASE_URL

# 执行特定查询
\i scripts/business-metrics.sql

# 或者复制粘贴单个查询
```

#### 方法C: 使用数据库客户端
推荐工具:
- TablePlus
- DBeaver
- pgAdmin
- DataGrip

**常用查询索引**:
- **1.1**: 用户总数和增长
- **2.1**: 匹配成功率
- **3.4**: 用户活跃度排行
- **6.1**: 完整转化漏斗
- **7.1**: 潜力用户识别
- **7.2**: 流失风险用户
- **8.2**: 需要发送提醒的匹配

### 3. 业务分析文档
**文件**: `docs/BUSINESS_ANALYSIS_AND_GROWTH_STRATEGY.md`

**内容**:
- 📊 核心业务指标定义
- 🔍 用户行为分析
- ⚠️ 关键问题诊断
- 💡 增长机会识别
- 📅 详细行动计划
- 🎯 增长策略建议

**适用场景**:
- 团队讨论和决策
- 投资人汇报
- 产品规划
- 增长策略制定

## 🚀 快速开始

### 第一次使用

**Step 1: 运行完整分析**
```bash
cd /Users/cindy/MockPal-Replicate
npx tsx scripts/business-metrics-analysis.ts > analysis-report-$(date +%Y%m%d).txt
```

这会生成一个带日期的分析报告文件，方便对比不同时期的数据。

**Step 2: 查看报告**
```bash
# 查看最新的报告
cat analysis-report-*.txt | less

# 或者用编辑器打开
code analysis-report-*.txt
```

**Step 3: 根据报告采取行动**

报告会明确告诉你：
- ⚠️ 哪些指标需要立即处理
- 👥 哪些用户需要发送邮件
- 📈 哪些策略可以尝试

### 定期监控

**每天（如果活跃用户多）**
```bash
# 快速查看核心指标
npx tsx scripts/business-metrics-analysis.ts | grep -A 10 "核心指标仪表板"
```

**每周**
```bash
# 运行完整分析，保存报告
npx tsx scripts/business-metrics-analysis.ts > weekly-report-$(date +%Y%m%d).txt

# 对比上周数据
diff weekly-report-20251014.txt weekly-report-20251021.txt
```

**每月**
```bash
# 运行分析并生成月报
npx tsx scripts/business-metrics-analysis.ts > monthly-report-$(date +%Y-%m).txt

# 更新增长策略文档
code docs/BUSINESS_ANALYSIS_AND_GROWTH_STRATEGY.md
```

## 📊 常见分析场景

### 场景1: 识别需要发送提醒的用户

**目标**: 找出所有匹配成功但未联系的用户

**方法1: 使用 TypeScript 脚本**
```bash
npx tsx scripts/business-metrics-analysis.ts | grep -A 20 "需要发送提醒"
```

**方法2: 使用 SQL 查询**
```sql
-- 执行 business-metrics.sql 中的查询 8.2
-- 结果会列出所有需要提醒的匹配
```

**输出**: 
- 匹配ID
- 双方用户信息
- 匹配日期
- 距今天数

**下一步**: 使用邮件脚本批量发送提醒

### 场景2: 识别高价值用户

**目标**: 找出最活跃的用户，考虑给予奖励或邀请成为大使

**方法**:
```bash
npx tsx scripts/business-metrics-analysis.ts | grep -A 30 "最活跃用户"
```

或执行 SQL 查询 **7.4**

**输出**:
- 用户ID和联系方式
- 活跃度得分
- 具体行为数据（浏览、匹配、反馈）

**下一步**:
1. 发送感谢邮件
2. 邀请成为产品测试者
3. 请求推荐新用户

### 场景3: 分析转化瓶颈

**目标**: 找出用户流失最严重的环节

**方法**:
```bash
npx tsx scripts/business-metrics-analysis.ts | grep -A 15 "转化漏斗"
```

或执行 SQL 查询 **6.1**

**输出**:
- 每个步骤的用户数
- 转化率
- 流失率

**分析**:
- 流失率 > 30% 的环节需要重点优化
- 对比行业标准
- 制定优化方案

### 场景4: 用户召回

**目标**: 找出流失风险用户，准备召回邮件

**方法**:
```bash
npx tsx scripts/business-metrics-analysis.ts | grep -A 20 "流失风险用户"
```

或执行 SQL 查询 **7.2**

**输出**:
- 用户信息
- 最后活跃时间
- 距今天数

**下一步**:
1. 分组：3-7天未活跃、7-14天、14天以上
2. 准备不同的召回邮件
3. 批量发送
4. 监控召回率

### 场景5: 评估增长策略效果

**目标**: 对比实施策略前后的数据变化

**方法**:
```bash
# 保存策略实施前的基线数据
npx tsx scripts/business-metrics-analysis.ts > baseline-2025-10-21.txt

# 一周后再次运行
npx tsx scripts/business-metrics-analysis.ts > after-strategy-2025-10-28.txt

# 对比关键指标
diff baseline-2025-10-21.txt after-strategy-2025-10-28.txt | grep -E "(用户数|成功率|转化率|活跃)"
```

**关注指标**:
- 用户增长率
- 匹配成功率变化
- 联系转化率变化
- 活跃用户数变化

## 🛠️ 自定义分析

### 添加新的分析指标

**1. 在 TypeScript 脚本中添加**

编辑 `scripts/business-metrics-analysis.ts`:

```typescript
// 在适当的位置添加你的分析
console.log('\n\n🆕 十一、你的新分析');
console.log('-'.repeat(80));

// 编写查询逻辑
const customData = await db.select()...

// 输出结果
console.log(`你的指标: ${customData.length}`);
```

**2. 在 SQL 文件中添加**

编辑 `scripts/business-metrics.sql`:

```sql
-- ==================== 11. 你的新分析 ====================

-- 11.1 你的查询标题
SELECT 
  ...
FROM ...
WHERE ...;
```

### 创建专项分析脚本

**示例: 分析特定用户群体**

创建 `scripts/analyze-specific-group.ts`:

```typescript
import { drizzle } from 'drizzle-orm/neon-http';
import { neon } from '@neondatabase/serverless';
import { users, userProfiles } from '@/lib/db/schema';

const dbClient = neon(process.env.DATABASE_URL!);
const db = drizzle(dbClient);

async function analyzeSpecificGroup() {
  // 你的分析逻辑
  const daUsers = await db.select()
    .from(userProfiles)
    .where(eq(userProfiles.jobType, 'DA'));
  
  console.log(`DA用户数: ${daUsers.length}`);
  // ... 更多分析
}

analyzeSpecificGroup().catch(console.error);
```

运行:
```bash
npx tsx scripts/analyze-specific-group.ts
```

## 📈 数据可视化

### 导出数据到 Google Sheets

**1. 从 SQL 导出 CSV**
```sql
-- 在 Neon Dashboard 执行查询
SELECT ... FROM ...

-- 点击 "Export" -> "CSV"
```

**2. 导入 Google Sheets**
- 上传 CSV 文件
- 创建图表

**3. 定期更新**
- 每周执行查询
- 更新数据
- 图表自动刷新

### 使用 Metabase / Superset

如果有数据可视化需求，可以连接：
- Metabase（开源BI工具）
- Apache Superset
- Grafana（时序数据）

连接信息从 `DATABASE_URL` 获取。

## 🔔 自动化监控

### 设置每日自动报告

**1. 创建 cron 任务**

```bash
# 编辑 crontab
crontab -e

# 添加每日早上9点运行
0 9 * * * cd /path/to/MockPal && npx tsx scripts/business-metrics-analysis.ts | mail -s "MockPal Daily Report" your@email.com
```

**2. 使用 GitHub Actions**

创建 `.github/workflows/daily-report.yml`:

```yaml
name: Daily Business Report

on:
  schedule:
    - cron: '0 1 * * *'  # 每天UTC 1:00 (北京时间 9:00)

jobs:
  report:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
      - run: npm install
      - run: npx tsx scripts/business-metrics-analysis.ts
        env:
          DATABASE_URL: ${{ secrets.DATABASE_URL }}
```

### 设置告警

**示例: 当联系转化率低于30%时告警**

在脚本末尾添加:

```typescript
const contactConvRate = parseFloat(contactConversionRate);
if (contactConvRate < 30) {
  // 发送告警邮件或Slack通知
  console.log('⚠️ 告警: 联系转化率过低！');
}
```

## 🤝 团队协作

### 分享分析报告

**1. 生成报告文件**
```bash
npx tsx scripts/business-metrics-analysis.ts > report.txt
```

**2. 分享方式**
- 发送邮件附件
- 上传到共享文档
- Slack/Discord 频道
- GitHub Discussion

### 定期数据会议

**建议频率**: 每周一次

**会议流程**:
1. 运行最新分析（15分钟前）
2. 对比上周数据
3. 讨论关键指标变化
4. 制定本周行动计划

**准备材料**:
- 最新分析报告
- 上周报告（对比）
- 增长策略文档

## 📚 扩展资源

### 学习资源
- [产品指标体系](https://www.reforge.com/blog/growth-loops)
- [转化漏斗优化](https://www.optimizely.com/optimization-glossary/conversion-funnel/)
- [用户留存分析](https://www.lennysnewsletter.com/p/what-is-good-retention-issue-29)

### 工具推荐
- **数据分析**: Metabase, Superset, Redash
- **邮件营销**: Resend, SendGrid, Mailchimp  
- **用户行为**: Mixpanel, Amplitude, PostHog
- **A/B测试**: Optimizely, VWO, Google Optimize

## ❓ 常见问题

### Q1: 脚本运行太慢怎么办？
A: 
- 添加数据库索引
- 限制查询范围（如只查询近30天）
- 分批次运行分析

### Q2: 如何对比不同时期的数据？
A: 
- 每次运行保存到文件（带日期）
- 使用 `diff` 命令对比
- 或创建时间序列表存储历史数据

### Q3: 如何自定义分析周期？
A: 
- 修改脚本中的时间范围
- 如 `INTERVAL '7 days'` 改为 `INTERVAL '30 days'`

### Q4: 数据看起来不对怎么办？
A: 
1. 检查数据库连接
2. 验证 `DATABASE_URL` 环境变量
3. 检查是否连接到正确的数据库（dev vs prod）
4. 查看是否有测试数据干扰

### Q5: 如何自动发送提醒邮件？
A: 
- 可以创建专门的脚本
- 参考 `scripts/send-match-success-email.ts`
- 使用 Resend 或其他邮件服务

## 🎯 下一步

1. **立即行动**: 运行第一次分析，获取基线数据
2. **设置定期**: 每周一固定时间运行分析
3. **采取行动**: 根据报告建议采取具体措施
4. **持续优化**: 监控指标变化，迭代策略

---

**祝你数据分析顺利！有任何问题随时查阅这份文档。** 📊

