# é…é¢å¥–åŠ±ç³»ç»Ÿ - åŠŸèƒ½è¯´æ˜

## ğŸ“Š åŠŸèƒ½æ¦‚è¿°

é€šè¿‡çœŸé¢˜äº’åŠ¨è·å¾—é¢å¤–åŒ¹é…é…é¢ï¼Œæ¿€åŠ±ç”¨æˆ·è´¡çŒ®å†…å®¹ï¼Œè§£å†³"åˆ·ä¸å¤Ÿäºº"çš„é—®é¢˜ã€‚

---

## ğŸ¯ æ ¸å¿ƒæœºåˆ¶

### åŸºç¡€è§„åˆ™

```
åŸºç¡€é…é¢ï¼š4ä¸ª/å¤©ï¼ˆæ‰€æœ‰ç”¨æˆ·ï¼‰
å¥–åŠ±é…é¢ï¼šæœ€å¤š+3ä¸ª/å¤©ï¼ˆé€šè¿‡å®Œæˆä»»åŠ¡è·å¾—ï¼‰
å¥–åŠ±ä½™é¢ï¼šå¯ç´¯ç§¯ï¼Œä¸Šé™6ä¸ª
æ€»é…é¢èŒƒå›´ï¼š4-7ä¸ª/å¤©
```

### ä»»åŠ¡å¥–åŠ±

#### ğŸ“ å‘å¸ƒçœŸé¢˜
- **å¥–åŠ±**ï¼š+2ä¸ªé…é¢
- **æ¡ä»¶**ï¼šæ¯å¤©ç¬¬1ç¯‡å‘å¸–æœ‰å¥–åŠ±
- **é™åˆ¶**ï¼šæ¯å¤©åªèƒ½è·å¾—ä¸€æ¬¡

#### ğŸ’¬ è¯„è®ºçœŸé¢˜
- **å¥–åŠ±**ï¼š+1ä¸ªé…é¢
- **æ¡ä»¶**ï¼šä»Šå¤©ç´¯è®¡è¯„è®º3æ¡ï¼ˆâ‰¥10å­—ï¼‰
- **é™åˆ¶**ï¼šæ¯å¤©åªèƒ½è·å¾—ä¸€æ¬¡

### å¥–åŠ±ä½™é¢

- âœ… å¯ä»¥è·¨å¤©ç´¯ç§¯ä½¿ç”¨
- âœ… ä¸Šé™6ä¸ªï¼ˆé˜²æ­¢å›¤ç§¯ï¼‰
- âœ… ä»Šå¤©å‘å¸–ï¼Œæ˜å¤©ç”¨ä¹ŸOK
- âœ… ä½¿ç”¨é¡ºåºï¼šå…ˆç”¨åŸºç¡€é…é¢ï¼Œå†ç”¨å¥–åŠ±ä½™é¢

---

## ğŸ“± ç”¨æˆ·ç•Œé¢

### 1. ä¸ªäººç•Œé¢ï¼ˆ/meï¼‰

æ˜¾ç¤º**é…é¢è¿›åº¦å¡ç‰‡**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’ æ¯æ—¥åŒ¹é…é…é¢    ä»Šæ—¥å¯ç”¨: 6ä¸ª   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åŸºç¡€é…é¢: 2/4  â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘              â”‚
â”‚ å¥–åŠ±ä½™é¢: 3ä¸ª  ğŸ’°                   â”‚
â”‚                                     â”‚
â”‚ ğŸ“ ä»Šæ—¥ä»»åŠ¡                         â”‚
â”‚                                     â”‚
â”‚ âœ… å‘å¸ƒ1æ¡çœŸé¢˜ â†’ +2ä¸ªé…é¢           â”‚
â”‚    å·²å®Œæˆï¼æ­å–œè·å¾—å¥–åŠ±             â”‚
â”‚                                     â”‚
â”‚ ğŸ“Š è¯„è®ºè¿›åº¦ â†’ +1ä¸ªé…é¢              â”‚
â”‚    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘  1/3æ¡                â”‚
â”‚    è¿˜å·®2æ¡è¯„è®ºå³å¯è·å¾—å¥–åŠ±          â”‚
â”‚                                     â”‚
â”‚ [å»å‘å¸ƒçœŸé¢˜]  [å»è¯„è®º]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. åŒ¹é…é¡µé¢ï¼ˆ/matchesï¼‰

é¡¶éƒ¨æ˜¾ç¤ºå½“å‰å¯ç”¨é…é¢å’Œæç¤º

---

## ğŸ› ï¸ æŠ€æœ¯å®ç°

### æ•°æ®åº“è¡¨

**user_daily_bonus**ï¼šè®°å½•æ¯æ—¥å¥–åŠ±æƒ…å†µ

```sql
- user_id: ç”¨æˆ·ID
- date: æ—¥æœŸï¼ˆYYYY-MM-DDï¼‰
- posts_today: ä»Šæ—¥å‘å¸–æ•°
- comments_today: ä»Šæ—¥è¯„è®ºæ•°
- bonus_quota: å½“å¤©æ–°å¢çš„å¥–åŠ±é…é¢
- bonus_balance: å¥–åŠ±é…é¢ä½™é¢ï¼ˆå¯ç´¯ç§¯ï¼Œä¸Šé™6ï¼‰
```

### APIæ¥å£

1. **GET /api/user/match-quota**
   - è·å–ç”¨æˆ·ä»Šæ—¥é…é¢ä¿¡æ¯
   - è¿”å›ï¼šåŸºç¡€é…é¢ã€å¥–åŠ±ä½™é¢ã€ä»»åŠ¡è¿›åº¦

2. **POST /api/interview-posts**
   - å‘å¸ƒçœŸé¢˜æ—¶è‡ªåŠ¨æ£€æŸ¥å¹¶å‘æ”¾å¥–åŠ±
   - è¿”å›ï¼šå¸–å­ä¿¡æ¯ + å¥–åŠ±ä¿¡æ¯

3. **POST /api/interview-comments**
   - è¯„è®ºæ—¶è‡ªåŠ¨ç´¯è®¡ï¼Œè¾¾åˆ°3æ¡å‘æ”¾å¥–åŠ±
   - è¿”å›ï¼šè¯„è®ºä¿¡æ¯ + å¥–åŠ±è¿›åº¦/å¥–åŠ±ä¿¡æ¯

### åŒ¹é…é€»è¾‘

ä¿®æ”¹ `lib/matching.ts`ï¼š
- `getUserDailyMatchLimit()`: è·å–æ€»é…é¢ï¼ˆåŸºç¡€+å¥–åŠ±ï¼‰
- `recordDailyView()`: ä½¿ç”¨æ€»é…é¢è¿›è¡Œé™åˆ¶æ£€æŸ¥

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. è¿è¡Œæ•°æ®åº“è¿ç§»

```bash
# è¿æ¥åˆ°ç”Ÿäº§æ•°æ®åº“
psql "your_database_connection_string"

# è¿è¡Œè¿ç§»æ–‡ä»¶
\i migrations/0014_add_quota_bonus_system.sql

# éªŒè¯è¡¨åˆ›å»ºæˆåŠŸ
\d user_daily_bonus
```

### 2. éƒ¨ç½²ä»£ç 

```bash
# æ¨é€ä»£ç åˆ°mainåˆ†æ”¯
git add .
git commit -m "feat: æ·»åŠ é…é¢å¥–åŠ±ç³»ç»Ÿ"
git push origin main

# Vercelä¼šè‡ªåŠ¨éƒ¨ç½²
```

### 3. éªŒè¯åŠŸèƒ½

1. è®¿é—® `/me` é¡µé¢ï¼ŒæŸ¥çœ‹é…é¢å¡ç‰‡
2. å‘å¸ƒä¸€æ¡çœŸé¢˜ï¼ŒéªŒè¯+2é…é¢
3. è¯„è®º3æ¡ï¼ŒéªŒè¯+1é…é¢
4. å»åŒ¹é…é¡µé¢ï¼ŒéªŒè¯å¯ä»¥ä½¿ç”¨æ›´å¤šé…é¢

---

## ğŸ“Š æ•°æ®ç›‘æ§

### å…³é”®æŒ‡æ ‡

```sql
-- 1. æ¯æ—¥å¥–åŠ±å‘æ”¾ç»Ÿè®¡
SELECT 
  date,
  COUNT(DISTINCT user_id) as active_users,
  SUM(CASE WHEN posts_today > 0 THEN 1 ELSE 0 END) as users_posted,
  SUM(CASE WHEN comments_today >= 3 THEN 1 ELSE 0 END) as users_commented,
  AVG(bonus_balance) as avg_bonus_balance
FROM user_daily_bonus
WHERE date >= CURRENT_DATE - INTERVAL '7 days'
GROUP BY date
ORDER BY date DESC;

-- 2. ç”¨æˆ·å¥–åŠ±è·å–æƒ…å†µ
SELECT 
  user_id,
  COUNT(*) as active_days,
  SUM(bonus_quota) as total_earned,
  MAX(bonus_balance) as max_balance
FROM user_daily_bonus
GROUP BY user_id
ORDER BY total_earned DESC
LIMIT 20;

-- 3. çœŸé¢˜å‘å¸ƒå¢é•¿
SELECT 
  DATE(created_at) as date,
  COUNT(*) as posts_count
FROM user_interview_posts
WHERE created_at >= CURRENT_DATE - INTERVAL '14 days'
GROUP BY DATE(created_at)
ORDER BY date DESC;
```

### é¢„æœŸæ•ˆæœ

åŸºäºæ•°æ®åˆ†æï¼š
- é¢„è®¡20%æ´»è·ƒç”¨æˆ·ä¼šå‘å¸– â†’ æ¯å‘¨+8ç¯‡çœŸé¢˜
- é¢„è®¡30%æ´»è·ƒç”¨æˆ·ä¼šè¯„è®º â†’ æ¯å‘¨+60æ¡è¯„è®º
- çœŸé¢˜åº“2-4å‘¨å†…å¯è¾¾50+ç¯‡
- ç¤¾åŒºæ°›å›´æ˜æ˜¾æ”¹å–„

---

## âš™ï¸ é…ç½®è°ƒæ•´

å¦‚æœéœ€è¦è°ƒæ•´å¥–åŠ±é¢åº¦ï¼Œä¿®æ”¹ä»¥ä¸‹ä½ç½®ï¼š

### å‘å¸–å¥–åŠ±ï¼ˆå½“å‰+2ï¼‰

```typescript
// app/api/interview-posts/route.ts
const newBalance = Math.min(existingBonus.bonusBalance + 2, 6); // ä¿®æ”¹è¿™é‡Œ
```

### è¯„è®ºå¥–åŠ±ï¼ˆå½“å‰3æ¡è¯„è®º+1é…é¢ï¼‰

```typescript
// app/api/interview-comments/route.ts
if (newCommentsCount === 3 && ...) { // ä¿®æ”¹è¯„è®ºæ•°è¦æ±‚
  const newBalance = Math.min(existingBonus.bonusBalance + 1, 6); // ä¿®æ”¹å¥–åŠ±æ•°
}
```

### ä½™é¢ä¸Šé™ï¼ˆå½“å‰6ä¸ªï¼‰

```typescript
// å…¨å±€æœç´¢å¹¶æ›¿æ¢æ‰€æœ‰ "bonusBalance < 6" å’Œ "bonusBalance + X, 6"
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆå‘å¸–äº†æ²¡æœ‰è·å¾—å¥–åŠ±ï¼Ÿ
A: å¯èƒ½åŸå› ï¼š
- ä»Šå¤©å·²ç»å‘è¿‡å¸–è·å¾—è¿‡å¥–åŠ±ï¼ˆæ¯å¤©é™1æ¬¡ï¼‰
- å¥–åŠ±ä½™é¢å·²æ»¡(6/6)

### Q2: è¯„è®ºäº†ä¸ºä»€ä¹ˆæ²¡æœ‰å¥–åŠ±ï¼Ÿ
A: å¯èƒ½åŸå› ï¼š
- è¯„è®ºå°‘äº10å­—ï¼ˆè´¨é‡æ§åˆ¶ï¼‰
- è¿˜æ²¡è¾¾åˆ°3æ¡è¯„è®º
- å¥–åŠ±ä½™é¢å·²æ»¡

### Q3: å¥–åŠ±é…é¢ä¼šè¿‡æœŸå—ï¼Ÿ
A: ä¸ä¼šè¿‡æœŸï¼Œå¯ä»¥ä¸€ç›´ç´¯ç§¯ä½¿ç”¨ï¼Œä¸Šé™6ä¸ª

### Q4: å¦‚ä½•æŸ¥çœ‹æˆ‘çš„å¥–åŠ±ä½™é¢ï¼Ÿ
A: è®¿é—® `/me` ä¸ªäººç•Œé¢ï¼Œé¡¶éƒ¨æœ‰é…é¢è¿›åº¦å¡ç‰‡

---

## ğŸ“ æ›´æ–°æ—¥å¿—

**2025-10-23**
- âœ… åˆ›å»ºæ•°æ®åº“è¡¨ `user_daily_bonus`
- âœ… å®ç°é…é¢æŸ¥è¯¢API `/api/user/match-quota`
- âœ… ä¿®æ”¹åŒ¹é…é€»è¾‘æ”¯æŒå¥–åŠ±é…é¢
- âœ… å‘å¸–APIé›†æˆå¥–åŠ±å‘æ”¾
- âœ… è¯„è®ºAPIé›†æˆå¥–åŠ±å‘æ”¾
- âœ… åˆ›å»ºä¸ªäººç•Œé¢é…é¢è¿›åº¦å¡ç‰‡
- âœ… å®Œæ•´æ–‡æ¡£å’Œè¯´æ˜

---

## ğŸ‰ æ€»ç»“

è¿™ä¸ªç³»ç»Ÿé€šè¿‡**é€‚åº¦æ¿€åŠ±**çš„æ–¹å¼ï¼š
1. âœ… è§£å†³ç”¨æˆ·"åˆ·ä¸å¤Ÿäºº"çš„ç—›ç‚¹
2. âœ… æ¿€åŠ±ç”¨æˆ·è´¡çŒ®é«˜è´¨é‡å†…å®¹
3. âœ… å»ºç«‹æ´»è·ƒçš„ç¤¾åŒºæ°›å›´
4. âœ… çµæ´»å¯è°ƒæ•´ï¼Œå¯æ ¹æ®æ•°æ®ä¼˜åŒ–

**é¢„æœŸ2å‘¨åçœŸé¢˜åŒºä¼šæ˜æ˜¾æ´»è·ƒèµ·æ¥ï¼** ğŸš€

